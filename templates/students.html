<div class="modal fade" id="modalDevices" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Dispositivos de <span id="devStudentName"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="deviceList" class="list-group mb-3"></div>
                <h6>+ Agregar Dispositivo</h6>
                <input type="hidden" id="devStudentId">
                <div class="input-group mb-2">
                    <input type="text" id="devTipo" class="form-control" placeholder="Tipo (Celular, PC)">
                    <input type="text" id="devModelo" class="form-control" placeholder="Modelo (Samsung, Dell)">
                    <button class="btn btn-success" onclick="saveDevice()">Add</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Añadir esta función al bloque <script> de students.html
let currentStudentId = null;

async function manageDevices(id) {
    currentStudentId = id;
    document.getElementById('devStudentId').value = id;
    const res = await fetch(`/devices/student/${id}`); // Necesitarás crear esta ruta GET en devices.py
    const devices = await res.json();
    
    const list = document.getElementById('deviceList');
    list.innerHTML = devices.length ? "" : "Sin dispositivos registrados.";
    devices.forEach(d => {
        list.innerHTML += `
            <div class="list-group-item d-flex justify-content-between">
                <div><strong>${d.tipo}</strong>: ${d.nombre_modelo}<br><small>${d.nextdns_device_id}</small></div>
                <button class="btn btn-sm btn-danger" onclick="removeDevice(${d.id})">x</button>
            </div>`;
    });
    new bootstrap.Modal(document.getElementById('modalDevices')).show();
}

async function saveDevice() {
    const payload = {
        student_id: currentStudentId,
        tipo: document.getElementById('devTipo').value,
        nombre_modelo: document.getElementById('devModelo').value
    };
    const res = await fetch('/devices/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
    });
    if(res.ok) manageDevices(currentStudentId);
}
</script>